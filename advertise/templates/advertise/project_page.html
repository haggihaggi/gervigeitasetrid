{% extends "base.html" %}
{% load wagtailcore_tags i18n %}

{% block body_class %}template-projectpage{% endblock %}

{% block content %}
<div class="container">
  <article class="project-detail">
    <header class="project-detail__header">
      <h1>{{ page.title }}</h1>
      {% if page.company_name %}
        <div class="project-detail__company">
          <strong>{% trans "Fyrirtæki" %}:</strong> {{ page.company_name }}
        </div>
      {% endif %}
      
      {% if page.leidbeinendur.all %}
        <div class="project-detail__supervisors">
          <strong>{% trans "Leiðbeinendur" %}:</strong>
          {% for item in leidbeinendur_with_pages %}
            {% if item.person_page %}
              <a href="{% pageurl item.person_page %}" style="color: inherit; text-decoration: underline;">
                {{ item.user.get_full_name|default:item.user.username }}
              </a>
            {% else %}
              {{ item.user.get_full_name|default:item.user.username }}
            {% endif %}{% if not forloop.last %}, {% endif %}
          {% endfor %}
        </div>
      {% else %}
        <div class="project-detail__supervisors">
          {% trans "Engir leiðbeinendur skráðir" %}
        </div>
      {% endif %}
    </header>

    <div class="project-detail__section">
      <div class="rich-text">
        {{ page.description|richtext }}
      </div>
    </div>

    {% if page.other %}
      <div class="project-detail__section">
        <h2>{% trans "Aðrar upplýsingar" %}</h2>
        <div class="rich-text">
          {{ page.other|richtext }}
        </div>
      </div>
    {% endif %}

    <div class="project-actions">
      {% if request.user.is_authenticated and 'Nemendi' in request.user.groups.all|stringformat:'s' %}
        <a href="{% pageurl page.get_parent %}" class="home-hero__cta">
          {% trans "Sækja um verkefni" %}
        </a>
      {% endif %}
      
      {% if request.user.is_authenticated and 'Starfsmenn' in request.user.groups.all|stringformat:'s' %}
        {% if request.user not in page.leidbeinendur.all %}
          <form method="post" action="{% url 'advertise:assign_to_project' page.id %}">
            {% csrf_token %}
            <button type="submit" class="home-hero__cta" style="cursor: pointer;" onclick="return confirm('{% trans "Ertu viss um að þú viljir hengja þig við þetta verkefni?" %}')">
              {% trans "Hengja við verkefni" %}
            </button>
          </form>
        {% else %}
          <div class="project-assigned">
            <span class="assigned-indicator">{% trans "Þú ert leiðbeinandi fyrir þetta verkefni" %}</span>
            <!-- Use the current language prefix -->
            <form method="post" action="/{{ LANGUAGE_CODE }}/unregister-from-project/{{ page.id }}/" style="display: inline; margin-left: 10px;">
              {% csrf_token %}
              <button type="submit" class="home-hero__cta" style="cursor: pointer; background-color: #dc3545; border-color: #dc3545;" onclick="return confirm('{% trans "Ertu viss um að þú viljir draga þig úr þessu verkefni?" %}')">
                {% trans "Draga úr verkefni" %}
              </button>
            </form>
          </div>
        {% endif %}
      {% endif %}
    </div>
  </article>
</div>
{% endblock %}